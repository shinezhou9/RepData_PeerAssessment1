RepData_Assignment1
========================================================
## Loading and preprocessing the data

```{r readdata}
data <- read.csv("activity.csv", header = TRUE, sep = ",")
data$date_revised <- as.Date(data$date)
data$interval_revised <- sprintf("%04d", data$interval)
data$interval_time <- strptime(data$interval_revised, format = "%H%M")
```


## Calculate mean total number of steps per day
```{r totalsteps}
s_date <- split(data, data$date_revised)
total_steps <- sapply(s_date, function(x) sum(x$steps))
```

### 1. histogram for total number of steps taken each day
```{r hist_totalstep, fig.height=4}
library(ggplot2)
qplot(total_steps, geom = "histogram", binwidth = 1000, fill = ..count.., xlab = "Total steps per day", ylab = "Number of Days", main = "Total steps per day Frequency")
#plot <- hist(total_steps, main = "Total steps per day", xlab ="total number of steps taken each day")
```

### 2. Calculate mean and median total number of steps taken per day
```{r mean_median_steps}
mean_steps <- mean(total_steps, na.rm = TRUE)
median_steps <- median(total_steps, na.rm = TRUE)
mean_steps
median_steps
```


## Average daily activity pattern with Missing data

### 1. Plot for average daily activity pattern
```{r seriesplot_activitypattern, fig.height=4}
s_pattern <- split(data, data$interval_revised) 
average_steps <- sapply(s_pattern, function(x) mean(x$steps, na.rm = TRUE))
day_pattern <- data.frame(time = data$interval_time[1:288], ave_steps = average_steps)
p_day <- ggplot(day_pattern, aes(x = time, y = ave_steps))
p_day+geom_line(colour = "tomato", size = .7)+labs(x = "interval", y = "Number of steps", title = "Average Daily Activity Pattern")
#plot(data$interval_time[1:288], average_steps, type = "l", col = "blue", main = "Average daily activity pattern", xlab = "interval", ylab = "Number of steps")
```

### 2. Get the most active 5-minute interval
```{r mostactive_interval}
max_index <- which(average_steps == max(average_steps))
max_interval <- data$interval_revised[max_index]
max_interval
```
*the 5-minute interval `r max_interval`, on average across all the days in the dataset, contains the maximum number of steps.*


## Imputing missing valuse

### 1. Calculate and report total number of missing values in the dataset. 
```{r number_missingValue}
bad <- is.na(data$steps)
num_NA <- length(data$steps[bad])
num_NA
```
*the total number of missing values in the dataset is `r num_NA`.*

### 2. Fill all the missing value by the mean for that 5-minute interval
**strategy**
- add a column to dataframe called "steps_revised".
- use mean for 5-minute interval steps as the value in "step_revised" column if it is missing value in original "steps" value. Otherwise, copy the steps number to the "step_revised" column.  
- create a new dataset equal to the original one, but replace the original "step" column's value by the "step_revised" column's value.
```{r fillNA}
data$average_steps <- average_steps
for (i in seq(nrow(data))) {
        if (is.na(data[i, "steps"])) {
                data$steps_revised[i] <- data[i, "average_steps"]
        }
        else {
                data$steps_revised[i] <- data[i, "steps"]
        }
}
```

### 3. Create a new dataset with missing data filled in. 
```{r createNewData}
data_revised <- data.frame(steps = data$steps_revised, date = data$date, interval = data$interval)
head(data_revised)
```

### 4. Make a plot steps taken each day, with missing value filled in
```{r hist_totalsteps_revised, fig.height=4}
s_date_revised <- split(data, data$date_revised)
total_steps_revised <- sapply(s_date_revised, function(x) sum(x$steps_revised, na.rm = TRUE))
qplot(total_steps_revised, geom = "histogram", binwidth = 1000, fill = ..count.., xlab = "Total steps per day", ylab = "Number of Days", main = "Total steps per day(simulated data)")
#plot <- hist(total_steps_revised, main = "Total steps per day_revised", xlab ="total number of steps taken each day_revised")
```

### Calculate mean and median total number of steps taken per day. 
```{r mean_median_revised}
mean_steps <- mean(total_steps_revised)
median_steps <- median(total_steps_revised)
mean_steps
median_steps
```
*These value almost the same after we filled in the missing value with the mean steps for that 5-minute interval.*

## Difference in activity patterns between weekdays and weekends?
### 1.Create a new factor variable indicating weekday or weekend
```{r factor_dayType}
library(timeDate)
data$day_type <- "weekdays"
data$day_type[isWeekend(data$date_revised)] <- "weekend"
data$day_type <- as.factor(data$day_type)
```

### 2. Calculate average steps of each 5-minutes interval for weekdays and weekend
```{r seriesplot_activitypattern_dayType}
#seperate the weekdays and weekend data into two groups
s_dayType <- split(data, data$day_type)
s_pattern <- lapply(s_dayType, function(x) split(x, x$interval_revised))
data_weekdays <- s_pattern[["weekdays"]]
data_weekend <- s_pattern[["weekend"]]

#calculate the weekdays and weekend's average steps for each 5-minutes interval.
average_steps_weekdays <- sapply(data_weekdays,function(x) mean(x$steps_revised))
average_steps_weekend <- sapply(data_weekend,function(x) mean(x$steps_revised))
```

### 3.Plot daily activity pattern for weekdays & weekend

```{r, fig.width=8}
weekdays <- data.frame(time = data$interval_time[1:288], ave_steps = average_steps_weekdays, day = "weekdays")
weekend <- data.frame(time = data$interval_time[1:288], ave_steps = average_steps_weekend, day = "weekend")
pattern <- rbind(weekdays, weekend)
pattern$day <- as.factor(pattern$day)

library(ggplot2)
p <- ggplot(pattern, aes(time, ave_steps,group = day))
p + geom_line(aes(colour = day), size = .7) + labs(x = "Interval", y="Number of steps", title = "Average daily activity pattern")
